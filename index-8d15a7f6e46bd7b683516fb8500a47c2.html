<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>DISTRIBUTION PACKAGING W/ SHADOW</title><meta name="mobile-web-app-capable" content="yes"><link rel="stylesheet" href="main.css"></head><body><article class="deck"><section class="title" data-title=""><h1>DISTRIBUTION PACKAGING W/ SHADOW</h1></section><section id="_about_me"><h2>About Me</h2><ul class="build build-items"><li><span class="primary"><span class="icon"><i class="fa fa-user"></i></span> Chief Technologist - Object Partners</span></li><li><span class="primary"><span class="icon"><i class="fa fa-globe"></i></span> <a href="http://www.objectpartners.com" class="bare">http://www.objectpartners.com</a></span></li><li><span class="primary"><span class="icon"><i class="fa fa-globe"></i></span> <a href="http://imperceptiblethoughts.com" class="bare">http://imperceptiblethoughts.com</a></span></li><li><span class="primary"><span class="icon"><i class="fa fa-twitter"></i></span> @johnrengelman</span></li><li><span class="primary"><span class="icon"><i class="fa fa-github"></i></span> johnrengelman</span></li></ul></section>
<section id="_what_is_shadow"><h2>What is Shadow?</h2></section>
<section id="_simple_answer"><h2>Simple Answer</h2><p>Fat (uber) JAR Creator</p></section>
<section id="_detailed_answer"><h2>Detailed Answer</h2><ul class="build build-items"><li><span class="primary">Dependency exploded/combiner</span></li><li><span class="primary">File filter/transformer</span></li><li><span class="primary">Package relocator</span></li></ul></section>
<section id="_downloads"><h2>Downloads</h2></section>
<section><figure class="image center"><img src="Shadow-pre-1.0.png" alt="Shadow pre 1.0"></figure></section>
<section><figure class="image center"><img src="Shadow-post-1.0.png" alt="Shadow post 1.0"></figure></section>
<section id="__1_000_000"><h2>&gt; 1,000,000 !!!</h2><ul><li><span class="primary">928K from bintray since 1st version published.</span></li><li><span class="primary">No data from Gradle Plugin portal</span></li></ul></section>
<section id="_adding_shadow"><h2>Adding Shadow</h2><figure class="listing"><figcaption>application/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">plugins {
  id 'java'
  id 'application'
  id 'com.github.johnrengelman.shadow' version '1.2.3'
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle application:shadowJar &amp;&amp; \
  java -jar application/build/libs/application-shadow.jar
Client Version 1.0.0</code></pre></section>
<section id="_configuring_the_task"><h2>Configuring the task</h2><figure class="listing"><figcaption>application/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  classifier = 'shadow' <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></figure>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Change the default of <code>all</code></td>
</tr>
</table>
</div></section>
<section id="_integration_with_application"><h2>Integration with Application</h2><figure class="listing"><figcaption>application/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">mainClassName = 'shadow.App'</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle runShadow
$ gradle distShadowTar
$ gradle distShadowZip</code></pre></section>
<section id="_filtering_files"><h2>Filtering Files</h2><p>Use the standard methods from <code>Jar</code> task</p></section>
<section><figure class="listing"><figcaption>application-resolved-versions/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  exclude 'adapter.properties'
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle application-resolved-versions:jarContent
META-INF/
META-INF/MANIFEST.MF
shadow/
shadow/App.class
shadow/AdapterVersion.class
META-INF/services/
META-INF/services/shadow.client.Version
shadow/client/
shadow/client/Version.class
shadow/Version.class</code></pre></section>
<section id="_filtering_dependencies"><h2>Filtering Dependencies</h2><p>Use the <code>dependencies{}</code> block</p></section>
<section><figure class="listing"><figcaption>application-filter-dependency/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  dependencies {
    exclude(dependency('shadow:client'))
  }
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle :application-filter-dependency:jarContent
META-INF/
META-INF/MANIFEST.MF
shadow/
shadow/AdapterVersion.class
adapter.properties
META-INF/services/
META-INF/services/shadow.client.Version</code></pre></section>
<section><ul><li><span class="primary">Dependency Filters are explicit per dependency</span></li><li><span class="primary">This means, you <strong>must</strong> exclude transitive deps explicitly</span></li></ul></section>
<section id="_shadow_configuration"><h2>Shadow Configuration</h2><p><code>project.configurations.shadow</code> holds runtime dependencies that are <strong>not</strong> merged</p></section>
<section><figure class="listing"><figcaption>application-shadow-conf/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">dependencies {
  compile 'shadow:client-adapter:1.0.0'
  shadow 'shadow:runtime-library:1.0.0' <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></figure>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This library will not be merged into the JAR</td>
</tr>
</table>
</div></section>
<section><figure class="listing"><figcaption>application-shadow-conf/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">tasks.withType(AbstractCompile) {
  classpath += project.configurations.shadow <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></figure>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>configurations.shadow</code> is not added to the compile classpath by default</td>
</tr>
</table>
</div></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle :application-shadow-conf:jarContent \
    :application-shadow-conf:runShadow
META-INF/
META-INF/MANIFEST.MF
shadow/
shadow/App.class
shadow/AdapterVersion.class
adapter.properties
META-INF/services/
META-INF/services/shadow.client.Version
shadow/client/
shadow/client/Version.class
shadow/Version.class

Adapter: Client Version 2.0.0
Executing runtime code!</code></pre></section>
<section id="_jar_transformations"><h2>JAR Transformations</h2></section>
<section id="_service_descriptors"><h2>Service Descriptors</h2><figure class="listing"><figcaption>application-transformer/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  mergeServiceFiles()
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle application-transformer:showServices
1.0.0
1.0.0-additional</code></pre></section>
<section id="_other_transforms"><h2>Other transforms</h2><figure class="listing"><figcaption>application-transformer/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  mergeGroovyExtensionModules()
  append 'META-INF/LICENSE'
  transform(XmlAppendingTransformer) {
    resource = 'properties.xml'
  }
}</code></pre></figure></section>
<section id="_package_relocation"><h2>Package Relocation</h2></section>
<section id="_conflicting_dependencies"><h2>Conflicting dependencies</h2><figure class="image"><img src="dot-example.svg" alt="dot example" width="324" height="250"></figure></section>
<section><figure class="listing"><figcaption>application-resolved-versions/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">dependencies {
  compile 'shadow:client:1.0.0'
  compile 'shadow:client-adapter:1.0.0'
}</code></pre></figure></section>
<section><figure class="listing"><figcaption>application-resolved-versions/src/main/java/shadow/App.java</figcaption><pre class="source"><code data-lang="java" class="language-java prettyprint">  public static void main(String[] args) {
    System.out.println(AdapterVersion.getVersion());
    System.out.println(Version.getVersion());
  }</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle application-resolved-versions:runShadow
Adapter: Client Version 2.0.0
Client Version 2.0.0</code></pre></section>
<section id="_relocate"><h2>Relocate</h2><figure class="listing"><figcaption>client-adapter/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  relocate 'shadow.client', 'adapter.shadow.client'
}</code></pre></figure></section>
<section id="_update_dependency"><h2>Update Dependency</h2><figure class="listing"><figcaption>application-adapter-all/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">dependencies {
  compile 'shadow:client:1.0.0'
  compile 'shadow:client-adapter-all:1.0.0'
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle application-adapter-all:runShadow
Adapter: Client Version 2.0.0
Client Version 1.0.0</code></pre></section>
<section id="_publishing_shadow_jars"><h2>Publishing Shadow JARs</h2><p>Simply apply Maven or Maven-Publish</p>
<p>(ivy-publishing untested)</p></section>
<section id="_with_maven_publish_plugin"><h2>With Maven-Publish Plugin</h2><figure class="listing"><figcaption>client-adapter-maven-publish/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">publishing {
  publications {
    shadow(MavenPublication) {
      from components.shadow
    }
  }
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle :client-adapter-maven-publish:publishToMavenLocal
$ ls ~/.m2/repositories/shadow/client-adapter-maven-publish/1.0.0/
client-adapter-maven-publish-1.0.0-all.jar <i class="conum" data-value="1"></i><b>(1)</b>
client-adapter-maven-publish-1.0.0.pom</code></pre>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notice the use of an artifact classifier</td>
</tr>
</table>
</div></section>
<section id="_producing_a_top_level_artifact_w_shadow"><h2>Producing a Top Level Artifact w/ Shadow</h2></section>
<section id="_with_maven_publish_plugin_2"><h2>With Maven-Publish Plugin</h2></section>
<section id="_first_configure_shadowjar"><h2>First, Configure ShadowJar</h2><figure class="listing"><figcaption>client-adapter-relocate/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  baseName = "${project.name}-all" <i class="conum" data-value="1"></i><b>(1)</b>
  classifier = "" <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre></figure>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override the baseName to not step on JAR output</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Remove the classifier as this will be a root artifact</td>
</tr>
</table>
</div></section>
<section id="_then_configure_publishing"><h2>Then Configure Publishing</h2><figure class="listing"><figcaption>client-adapter-relocate/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">publishing {
  publications {
    shadow(MavenPublication) {
      from components.shadow
      artifactId "${project.name}-all"
    }
  }
}</code></pre></figure></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle :client-adapter-relocate:publishToMavenLocal
$ ls ~/.m2/repositories/shadow/client-adapter-relocate-all/1.0.0/
client-adapter-relocate-all-1.0.0.jar
client-adapter-relocate-all-1.0.0.pom</code></pre></section>
<section id="_with_maven_plugin"><h2>With Maven Plugin</h2><figure class="listing"><figcaption>client-adapter/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">shadowJar {
  baseName = 'client-adapter-all'
  classifier = ''
}</code></pre></figure></section>
<section id="_multi_projects"><h2>Multi-Projects</h2><p>Use the <code>Map</code> notation for a project dependency</p></section>
<section><figure class="listing"><figcaption>multi-app/build.gradle</figcaption><pre class="source"><code data-lang="gradle" class="language-gradle prettyprint">dependencies {
  compile 'shadow:client:1.0.0'
  compile project(path: ":client-adapter-relocate", configuration: 'shadow') <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre></figure>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Depend on the <code>shadow</code> configuration from the project</td>
</tr>
</table>
</div></section>
<section><pre class="source"><code data-lang="bash" class="language-bash prettyprint">$ gradle :multi-app:run
Adapter: Client Version 2.0.0
Client Version 1.0.0</code></pre></section>
<section id="_user_guide"><h2>User Guide</h2><p><a href="http://imperceptiblethoughts.com/shadow" class="bare">http://imperceptiblethoughts.com/shadow</a></p></section>
<section id="_remember"><h2>REMEMBER</h2></section>
<section id="_the_shadow_knows"><h2>THE SHADOW KNOWS</h2></section>
<section class="image" style="background-image: url(shadow.jpeg); background-size: cover; background-repeat: no-repeat"><figure class="image canvas"><img src="shadow.jpeg" alt="shadow"></figure></section></article><script src="main.js"></script></body></html>
